With the model numbers found on the DVR we want to google them and take a look for the following:

**Fundermentals** 
- Manafacturers instruction manuals 
- Firmware
- FCC - https://fccid.io/


**Has it been looked at previously?**
- Exploits on Explot DB
- Any write ups of previous research
- CVE's 
- News Articles
- Github repos

Researching the model number came up with information regarding the chip being manafactured by Hisilicon.

This chip is used in other systems.

Trying to find the most accurate firmweare with the board number brought dead ends and dodgy websites and many varients of the model number on the board itself being HS-NH-B3520DH-4.
Normally you would find the cersion number via the info panel on the CCTV system. However since I was locked out I was unable to do this. 
There are a couple of methods of entry points into the DVR CCTV System.

So what can we do with a dvr
We can look at the:

Web Panel
Network traffic
Embedded admin panel
Mobile application 
Physical hardware. 



We have:


- Web Panel - Username & Password

- CCTV Admin panel - Username & Password

- Open Ports - Port 23 / 22 Closed

- UART Connection


===

I did not have the username or the password but discovered a talk by Benjamin Tamasi.

Unfortunetly although my system was very similar in way to his identivisiion cctv system, his methods would not work on my system.

He used one method of entering the admin username without a password seven times to bypass the CCTV login screen. This flaw was not in my system.

I used an unsecured url DVR.htm  This then let me see the basic version information.
CVE-2018-171919  CVE-2018-17915
Default with no password logs in as guest on the system also.

*** Picture of basic info***


This basic version information showed the firmware version. Unfortunetly though I was unable to find the exact firmware vversion online. 

** Web Panel Manual testing**
So first up the web panel.
I normally undertake a level of manual testing to get a feel for the applications.

As you can see here they were super helpful by telling me that I have the incorrect password or username.
They also like to insist on you using a very much older browser version to get it working correctly.

So I pulled out internet explorer to take a better look.
Just to note it's worth having different browsers as the behaviours can sometimes change dependending on what you use. 

When I opened it up in internet explorer it wanted me to download a exe, this exe would help install the active x plugins so it would work properly. 
That was a hard pass. 

I would say its worth reviewing the source code on the pages as I was able to find out further links and information from this. 

So normally whilst I am doing this I will have wireshark up and running

** Network Traffic**

Wireshark is a tool which can help you disect and review network traffic. 
There are literal books and courses on it, so I wont go to in depth here.
But if you look at the information panes you will see I was able to get some useful information to help me get started. 

I could see that it was using insecure protocol such as HTTP, therefore all the traffic was being sent plane over the network.
I could also seee that it was running UC-HTTPD server.

When inspecting the traffic I could also see that when sending over just a blank password it was pre filling it with some text. 

So I headed over to some CVE databases and done a search on it.  

I found a couple onee being that you could log in as guest onto the system with a blank password. 

** Existing Vulnerabilities
There were some more interesting CVE’s I found a buffer overflow but it was the directory traversal which was of interest to me.
So I span up burp...And it worked really well, I was able to get the root credentials. 

Burpsuite is a web application testing tools which is really handy for CTF’s bug bountys and web app pentesting. 

The next thing I done was take these credentials and put them in Hashcat.

** cracking Hashes**

Hash cat with crack hashed passwords and passwords lists that you give it.
This time round it took less that 5 minutes but it is worth looking into the flags you can use to help with use and cut down time.  


** Existing Research **
So whilst this was running I decided to google the creds.
And it was a pretty good idea I did. 
I came across tothi’s work and his github write up, where he writes about exploiting hisilicon chip based dvr’s. 

As you can see his research was applicable across a wide range of makes and models and this is because a lot of manufactures will use the generic H264 firmware. 

So im all like awesome great, he says here with the user root and the password XC3511 I can log on to telnet port 23 and get access and that this is a hard coded back door.

The password matched the output from Hashcat..so I would give it a go.

So heres the value in saving time by seing what others have done...but in my case


** Telnet Access

 -Denied
 
 ** Nmap**

Now Nmap is a great tool for seeing what running services and ports are on the product.

I’m running it here with jst a basic nmap scan and I havve also done a scan with UDP.
There are all sorts of fancy stuff and firewall evasion techniques you can do with it.
But you need to be care as it has been known to knock boxes offline and restart products. 
It also comes in a windows flavour called zenmap and you can see from the output there is no port 23 enabled. 


Directory Traversal
There were areas on the system which were called account 1 & 2

Account 2 is backup credential account. Account 1 is overwritten with new users.
I know this as I found my own credentials in there.
However it wasnt my password, it was showing some random hashed value I didnt know. 

Rainbow Tables
There was some concept code which showed how this hash function was working. 
And since hashing is a one way function we decided to route some password lists through it to make a rainbow table. 

But of course I wouldnt be that stupid to have my password on a password list like rockyou.

One of the things I did notice was that a blank password was the same blank password value which was submitted on the web panel.
But it was weird as it wouldn't accept the hashed passwords I had found online or in Account 1. 

I was starting to hit brick walls again until...


RTSP
We saw we could put this hash value in as a password within the RTSP stream to view the cameras.
So thats cool I could see my cameras and also..

#!/bin/bash
xterm -hold -e cvlc 'rtsp://192.168.1.10:554/user=admin&password=xc3511&channel=1&stream=0.sdp' &
xterm -hold -e cvlc 'rtsp://192.168.1.10:554/user=admin&password=xc3511&channel=2&stream=0.sdp' &
xterm -hold -e cvlc 'rtsp://192.168.1.10:554/user=admin&password=xc3511&channel=3&stream=0.sdp' &
xterm -hold -e cvlc 'rtsp://192.168.1.10:554/user=admin&password=xc3511&channel=4&stream=0.sdp'


Shodan
Everyone elses on Shodan who had the same default creds….
I mean I didnt right as thats a very bad thing to do. 



Devices
https://www.shodan.io/search?query=uc-httpd+1.0.0

Exploit & News writeups
https://lfto.me/reverse-engineering-dvr-firmware/
https://github.com/tothi/hs-dvr-telnet
https://github.com/tothi/pwn-hisilicon-dvr/blob/master/README.adoc
https://www.exploit-db.com/docs/english/44003-hisilicon-dvr-hack.pdf
https://translate.google.com/translate?hl=en&sl=zh-CN&tl=en&u=https%3A%2F%2Fwww.cnblogs.com%2Fmmseh%2Fp%2F6537924.html
https://www.stuff.za.net/2016/05/notes-on-hacking-an-aprica-8-channel-cctv/
https://news.slashdot.org/story/16/06/27/2157204/a-massive-botnet-of-cctv-cameras-involved-in-ferocious-ddos-attacks
https://www.stuff.za.net/2016/05/notes-on-hacking-an-aprica-8-channel-cctv/
http://blog.0x42424242.in/2019/04/besder-investigative-journey-part-1_24.html
https://habr.com/en/post/486856/

cctv firmware & useful tangents
https://fccid.io/
https://itsjack.cc/blog/2015/04/unpacking-cctv-firmware/
https://www.enster.com/faq/Link-for-downloading-DVRNVR-fi.html
https://www.youtube.com/watch?v=gEC_F_DsAZQ
https://www.youtube.com/watch?v=2vzOqIgBW9o
https://www.winbond.com/resource-files/w25q128fv%20rev.m%2005132016%20kms.pdf
http://www.kerneronsec.com/2016/02/remote-code-execution-in-cctv-dvrs-of.html




Root Password


Using a directory travesal bug in the UC-http Server (uc-http1.0.0.0 CVE-2017-7577) I was able to get to the files on the CCTV box.

Digging around I found the Account1 and Account 2 password file

Also I was able to get the hardcoded root password which was hashed.
